---
title: "PSTAT131 Final Project"
author: "Joseph Chang, Tom Wei, Akul Bajaj"
date: "3/11/2022"
output: pdf_document
---

```{r setup, include=FALSE, echo = FALSE}
# set global chunk options: images will be 7x5 inches
knitr::opts_chunk$set(fig.width=7, fig.height=5, echo =TRUE)
options(digits = 4)
```

## packages
```{r}
#install.packages("tidyverse")
#install.packages("corrplot")
#install.packages("ggplot2")       
#install.packages("GGally")
library("ggplot2")                     
library("GGally")
library(tidyverse)
library(knitr)
library(dplyr)
library(tidyverse)
library(modelr)
library(pander)
library(corrplot)

```

## read data
```{r}
# this is where we will input the data 

# first dataset
X2020_2021_NBA_Stats_Player_Box_Score_Advanced_Metrics
bball_stats <- as.data.frame(X2020_2021_NBA_Stats_Player_Box_Score_Advanced_Metrics)
my_colnames <- c('Rank', 'Player', 'Team', 'Position', 'Age', 'Games.Played', 'MPG', 'Minutes%', 'Usage Rate' , 'Turnover rate', 'free throws attempted', 'Free throw%', '2-point field goals attempted', '2-point%', '3-point field goals attempted', 'three-point %', 'effective shooting %' , 'True shooting %', 'PPG', 'RPG', 'Total rebound %', 'APG', 'Assist %', 'SPG' ,'BPG', 'TPG', 'Versatility Index', 'Offensive Rating' , 'Defensive rating')
colnames(bball_stats) <- my_colnames
new_bball_stats <- bball_stats[-1,-1]
new_bball_stats

# second dataset
labels <- c('Player','Position', 'Age', 'Team', 'Games', 'Minutes played', 'Player Efficiency Rating', 'true shooting %', '3-point attempt rate', 'free-throw attempt rate', 'offensive rebound percentage', 'defensive rebound percentage', 'total rebound percentage', 'assist percentage', 'steal percentage', 'block percentage', 'turnover percentage', 'usage rate', 'offensive win shares', 'defensive win shares', 'win shares','win shares per 48 minutes', 'Offensive Box Plus/Minus', 'Defensive Box Plus/Minus','Box Plus/Minus','Value Over Replacement')
data_advanced <- read.csv("nba2021_advanced.csv", col.names = labels, na= "XXX")
data_advanced

# salaries dataset
labels2 <- c('Rank', 'Player', 'Salary', 'Use', 'Guaranteed')
salaries <- read.csv("nba_salaries_21-22.csv", col.names = labels2)
salaries
```

## here is a comment
## Merge data?
```{r}
# this is where we merge data
combine <- inner_join(new_bball_stats, data_advanced, by = 'Player') %>% 
  inner_join(salaries, by = 'Player')
  
# cut down all predictors to only 24 predictors
selection <- subset(combine, select= -c(2:4,7,9,10,12:14,20,22,29:33,35:47,49:51,54,56:57))
less_data <- selection %>% relocate(c(PPG,RPG,APG,SPG,BPG,TPG), .before = MPG)
less_data

# Convert predictors in less_data all to dbl, not chr
conversion <- less_data[,2:22] %>% mutate_if(is.character,as.numeric)
conversion1 <- conversion %>% add_column(less_data$Player) 
names(conversion1)[names(conversion1) == "less_data$Player"] <- "Player"
conversion2 <- conversion1 %>% relocate((Player), .before = Games.Played)
conversion2
```

## filter data
```{r}
# filter players with games played over 10, then filter with total minutes played over 100
our_data <- conversion2 %>% filter(Games.Played >= 10 & MPG > 10) %>% select(Player:Salary) %>% drop_na()
our_data
```

## Check to see Correlation
```{r}
# correlation to see predictors vs other predictors in our_data2
my_cor <- our_data %>% select_if(is.numeric) %>% drop_na() %>% cor() %>% round(3)
corrplot(my_cor, method = "circle", type = "upper")
```
##Correlation2
```{r}
salarycor<- our_data %>% select(Salary, Games.Played,PPG,RPG,APG,SPG,BPG,TPG,Minutes.played,MPG,`Usage Rate`,`Free throw%`,`three-point %`,`Versatility Index`,`Offensive Rating`,`Defensive rating`,win.shares,Box.Plus.Minus,Value.Over.Replacement) %>% drop_na()
ggpairs(salarycor)
cor(salarycor)[,"Salary"]
```
Correlation: PPG>MPG>TPG>Value.Over.Replacement>APG>win.shares>Versatility Index>Box.Plus.Minus>Usage Rate>
Minutes.played>RPG>SPG>Free throw%>Offensive Rating>Defensive rating>BPG>Games.Played>three-point %



## Plot of response variable
```{r}
plot(our_data$Salary)
hist(our_data$Salary)
```


## training and testing data
```{r}
# Set random seed
set.seed(3112022)

# Sample 80% observations as training data
fit_data <- our_data[-1]
new_data <- resample_partition(fit_data, p = c(test=0.2, train=0.8)) 
training <- as.data.frame(new_data$train)
testing <- as.data.frame(new_data$test)
```

## Linear regression
```{r}
# linear regression for data

# training data
fit <- lm(Salary ~ ., data = training)
summary(fit)

# predicted salaries for training
na.omit(training)
train.predict <- predict(fit, training)

# predicted salaries for testing
test.predict <- predict(fit, testing)

# MSE of train/test
mean((train.predict-training$Salary)^2)
mean((test.predict-testing$Salary)^2)


# predictors that have high correlation with Salary (p-value less than 0.05)
fit2 <- lm(Salary ~ Games.Played + PPG+RPG+APG+TPG+MPG, data= fit_data)
summary(fit2)
```


## Logistic regression?
```{r}
glm()
```


## Lasso / Ridge ?
```{r}

```










